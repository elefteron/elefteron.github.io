<html><head><title> Bible-(BG) reformater </title>
	<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
	<link rel="SHORTCUT ICON" href="bible4.ico" type="image/x-icon" />
	<style>a:hover{color:black;background-color:gold;font-family: Arial Cyr,Arial,Tahoma,Verdana} </style>
<!-- .hta  header -->
<HTA:APPLICATION ID=Bible-(BG)  applicationName=Bible-(BG)
    border        ="thick"    // none thin dialog thick
    borderStyle   ="normal"   // normal complex static sunken raised
    windowState   ="normal"   // minimize maximize normal
    application   ="yes"      singleInstance="no"
    caption       ="yes"      scroll        ="yes"
    contextMenu   ="yes"      scrollFlat    ="no"
    innerBorder   ="yes"      selection     ="yes"
    maximizeButton="yes"      sysMenu       ="yes"
    minimizeButton="yes"      showInTaskBar ="yes"
    navigable     ="yes"      icon          ="bible4.ico">
<!-- end hta -->
     <script src="scr/nt-hdr.js"></script>
     <script src="scr/ot-hdr.js"></script>
     <script src="paths.js"> </script><!-- ../lib/: getdata pathload pathpages pathkalendar -->
<script>
  ie=navigator.userAgent.indexOf('MSIE'     )>-1; if(ie) brw='IE';
  if(ie){/* IE only:  C:\WINDOWS\System32\mshta.exe "%1" %* */
    fso      =new ActiveXObject("Scripting.FileSystemObject") 
  };
  ax=(fso!=undefined) 
  // ---
  loadf=null; savef=null; eof=false; opened=false 
  function openR(fn){ ln=0; txt=''
    iomode=1 // iomode=1:read, 2:write 8:append
    createNewIfUnexist=false; Unicode=false
    loadf=fso.OpenTextFile(fn,iomode,createNewIfUnexist,Unicode);
    opened=true
  }// ---
  function openW(fn){ ln=0; txt=''
    iomode=2 // iomode=1:read, 2:write 8:append
    createNewIfUnexist=true; Unicode=false
    savef=fso.OpenTextFile(fn,iomode,createNewIfUnexist,Unicode);
    opened=true
  }// ---
</script>
</head>

<body BGCOLOR="black" text="#FFCC00" link="cyan" alink="red" vlink="#7B68EE">
<font face="Arial Cyr,Arial,Tahoma,Verdana" size=4><b><pre>
<script> eol='\n'
  out('--- reformat bible text: txt2txt|txt2js ---'+eol)
/* ----- */ cfg=2 // -----------------------------------------
  dirname ='E:/Tedy/art-el/art-el.bg/my-dev/Bible.proj/Bible-(BG).txt/'
  txt2js=false; wr=false; aft=false// already formated txt:  #[]# || {}
  if       (cfg==1){// OT txt to txt
    txt2js=false; wr=true; 
    inputfilename ='Bible-(BG)OT-original.txt'; 
    resultfilename='Bible-(BG)OT' 
    //      15571        |ПСАЛОМ 1| {22.42.01}  ?  
  } else if(cfg==2){// OT txt to js
    txt2js=true; wr=true; aft=true
    inputfilename ='Bible-(BG)OT.txt'; 
    resultfilename='Bible-(BG)OT' 
    // Line:12485,19969  |.... ??|   .00.00}  ; ->txt[14][NaN], txt[27][NaN]== -> послеслов,предисловие
  } else if(cfg==3){// NT txt to txt
    txt2js=false; wr=true;
    inputfilename ='Bible-(BG)NT.txt'; 
    resultfilename='Bible-(BG)NT' 
  } else if(cfg==4){// NT txt to js
    txt2js=true; wr=true; aft=true
    inputfilename ='Bible-(BG)NT.txt'; 
    resultfilename='Bible-(BG)NT' 
  }
// ----------------------------------------------------------
  if(!aft)  out('==not formated as text'+eol); else out('==already formated as text'+eol); 
  if(txt2js)out('==js formating...'+eol);      else out('==text formating...'+eol)
  if(!ie){out('not IE! - ActiveXObject() only under IE browser'+eol);}
  if(!ax){out('ActiveXObject() not created'+eol)                    ;}
  if(!txt2js)resultfilename+='.txt'; else resultfilename+='.js'
  out('dir :'+dirname+eol+'inpfile:'+inputfilename+eol+'outfile:'+resultfilename+eol)
  if(fso.FileExists(dirname+inputfilename)) exist=true; else exist=false
  if(exist) out('==dir/file exist'+eol)
  else     {out('==dir/file not exist'+eol)}
// ----------------------------------------------------------
  var gf='<font color="gold">' ,rf='<font color="red">'  , cf='<font color="cyan">'
    , bf='<font color="blue">' ,lf='<font color="lime">' , mf='<font color="magenta">' 
    , ef='</font>'
  if(ie&ax&exist){
    openR(dirname+inputfilename);       if(opened)out('==inp opened ok'+eol)
    if(wr){ 
      if(!window.confirm('the output file will be overvrited!','Run/stop'))Quit();
      openW(dirname+resultfilename); if(opened)out('==out opened ok'+eol)
    }
    var ln=0, txt='',txt2='', k='',key=['[','|','{','*','#'], i,j ,b=0,c,v
    while(!loadf.AtEndOfStream){ 
      txt=loadf.ReadLine(); ln++; fnd=-1
      if(!(txt==' ' || txt=='')){
        for (i=0; i<=3; i++){
          k=txt.indexOf(key[i]);if(k>-1){fnd=i;break}
        } // first key
        if(k>0 && fnd==3) fnd=-1
        nf=gf
        switch(fnd){ // 16582 
          case  0:  i=txt.indexOf('[')+1;j=txt.indexOf(']');  
                    b=txt.substr(i,j-i);
                    if(!aft){txt2='#'+txt+'#'; 
                    }else    txt2=txt
                    if(txt2js) { b=b/1// clear lead zero
                      txt2="'"+txt2+"'"
                      txt2='txt['+b+'][0]='+txt2
                    }
                    c=0;//b=n2(b)
                    out(ln+' '+rf+txt2+ef+eol) // ok
            break; 
          case  1:  txt2=txt;
                    if(txt.charAt(txt.lenght-1)=='.'){nf=lf;txt2=txt+'|'}
                    i=txt.indexOf('|ГЛАВА')//+7 
                    if(i==-1){ i=txt.indexOf('|ПСАЛОМ')//+8;
                      if(i!=-1)i=i+8
                    }else      i=i+7   
                    if(i!=-1){nf=lf;
                      j=txt.lastIndexOf('|');
                      if (i==j)out(ln+' *data err: miss second |*'+rf+txt+ef+eol) //  
                      else c=txt.substr(i,j-i);
                    }
                    if(txt2js) { c=c/1// clear lead zero
                      txt2="'"+txt2+"'"
                      if(i!=-1) txt2='txt['+b+']['+c+']='+txt2
                      else txt2='+'+txt2
                    }                      
                    //c=n2(c)
                    out(ln+' '+nf+txt2+ef+eol) //ok
            break; 
          case  2:  txt2=txt
                    if(txt2js) txt2="+'"+txt2+"'"
                  //out(ln+' '+txt2+eol) // {} manually, ok
            break; 
          case  3:  txt2=txt
                    if(txt2js) txt2="+'"+txt2+"'"
                  //out(ln+' '+lf+txt2+ef+eol) // * _____ ok
            break;
          case  4:  txt2=txt
                    if(txt2js) txt2="+'"+txt2+"'"
                  //out(ln+' '+lf+txt2+ef+eol) // # _____# ok
            break;
          case -1://out(ln+' '+cf+txt+ef+eol)
                    txt2=txt; 
                    i=txt.indexOf('ГЛАВА')
                    if(!aft && i==0)  {nf=bf; i=i+5
                      j=txt.indexOf('.'); 
                      c=txt.substr(i,j-i); c=c/1 
                      txt2='|ГЛАВА '+n2(c)+'|'+txt.substr(j+1,txt.lenght)     // ok                      
                      if(txt2js) {
                        txt2="'"+txt2+"'"
                        txt2='txt['+b+']['+c+']='+txt2
                      }                      
                    }
                    i=txt.indexOf('ПСАЛОМ')
                    if(!aft && i==0) {nf=mf; i=i+6
                      j=txt.indexOf('.'); 
                      c=txt.substr(i,j-i); c=c/1 
                      if(c>99) cn=n3(c); else cn=n2(c)
                      txt2='|ПСАЛОМ '+cn+'|'+txt.substr(j+1,txt.lenght)     // ок                      
                      if(txt2js) {
                        txt2="'"+txt2+"'"
                        txt2='txt['+b+']['+c+']='+txt2
                      }                      
                    }
                    if(nf!=gf) out(ln+' '+nf+txt2+ef+eol)  
                    
                    if(!aft && nf==gf){
                      i=txt.indexOf('.');
                      if(i>=0 && i<=2){ 
                        buf1=txt.substr(0,i);
                        buf2=txt.substr(i+1,txt.lenght)
                        if(buf1==' ' || buf1=='  ' || buf1=='   ')buf1=0
                        v='00'; i=buf1.length; 
                        if (i==3) v=n3(buf1); else v=n2(buf1);
                        txt2='{'+n2(b)+'.'+n2(c)+'.'+v+'} '+buf2
                      }                      
                    }
                    if(txt2js) txt2="+'"+txt2+"'"
                    // out(ln+' '+cf+txt2+ef+eol) // ***. ____
            break;
          default:out(ln+'??? '+fnd+' '+mf+txt+ef+eol) // must not exist!
            break;
        }// switch
        if(wr)savef.WriteLine(txt2); txt=txt2=''// write to file here
      }// while
    };loadf.Close(); if(wr)savef.Close();
    eof=true; out('==eof, ln='+ln+ef+eol)
  }
exit:  
// txt[1][0]='#[01] От Матея Свето Евангелие#'
// txt[1][1]='|ГЛАВА 1|'
</script> 
</font> 
</body></html>